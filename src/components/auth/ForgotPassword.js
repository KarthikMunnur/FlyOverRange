import React, { Component } from "react";
import { connect } from "react-redux";
import { signIn, passwordReset } from "../../store/actions/authActions";
import { Redirect } from "react-router-dom";
import firebase from "firebase";

class ForgotPassword extends Component {
  constructor(props) {
    super(props);
    this.state = {
      email: null,
      showError: null,
    };

    this.handleChange = this.handleChange.bind(this);
  }

  handleChange = (e) => {
    this.setState({
      [e.target.id]: e.target.value,
    });
  };

  handleSubmit = async (event) => {
    event.preventDefault();
    const { passwordReset } = this.props;

    if (this.state.email) {
      const isUser = await firebase
        .auth()
        .fetchSignInMethodsForEmail(this.state.email);
      if (isUser.length > 0) {
        passwordReset(this.state.email);
      } else {
        this.setState({ showError: "please enter valid email" });
      }
    } else {
      this.setState({ showError: "please enter email" });
    }
  };
  render() {
    const { authError, auth } = this.props;
    if (auth.uid) return <Redirect to="/" />;
    return (
      <div className="form-layout" id="newuser-signin">
        <div id="forgot-page-logo" class="mb-100">
          <a href="/">
            <svg width="171px" height="36px" viewBox="0 0 171 36">
              <g
                id="Logo_1"
                stroke="none"
                stroke-width="1"
                fill="none"
                fill-rule="evenodd"
              >
                <g id="Group" transform="translate(3.000000, 2.000000)">
                  <g id="Group-4">
                    <rect
                      id="Rectangle-Copy-11"
                      fill="#2F2E2E"
                      x="0"
                      y="0"
                      width="31.9747794"
                      height="31.9747794"
                      rx="10.2028614"
                    ></rect>
                    <g
                      id="Group-15-Copy-4"
                      transform="translate(6.644110, 5.813596)"
                    >
                      <g id="Group-15-Copy">
                        <path
                          d="M9.55090812,21.5933575 C12.5700402,21.5933575 14.9166412,20.789226 16.5907112,19.1809631 C18.2647812,17.5727001 19.1018162,15.2927509 19.1018162,12.3411153 L19.1018162,10.2170132 L13.4409437,10.2170132 L13.4409437,12.1708287 C13.4409437,15.3495131 12.1636186,16.9388553 9.60896836,16.9388553 C7.03496475,16.9388553 5.74796294,15.3495131 5.74796294,12.1708287 L5.74796294,0 L0,0 L0,12.3411153 C0,15.2927509 0.837035008,17.5727001 2.51110502,19.1809631 C4.18517504,20.789226 6.53177607,21.5933575 9.55090812,21.5933575 Z"
                          id="U"
                          fill="#FFFFFF"
                          fill-rule="nonzero"
                        ></path>
                        <polyline
                          id="Path-9"
                          stroke="#50C2E6"
                          stroke-width="5.56112007"
                          points="9.55090812 13.553161 9.55090812 2.77248607 16.1880567 2.77248607 16.1880567 9.58685155"
                        ></polyline>
                        <path
                          d="M12.358341,16.1170871 C12.358341,14.5570792 11.1182757,13.292443 9.54508347,13.292443 C7.97189127,13.292443 6.73765064,14.5570792 6.73765064,16.1170871 L12.358341,16.1170871 Z"
                          id="Oval"
                          fill="#50C2E6"
                          transform="translate(9.547996, 14.704765) rotate(-180.000000) translate(-9.547996, -14.704765) "
                        ></path>
                      </g>
                    </g>
                  </g>
                  <g
                    id="UnReveald"
                    transform="translate(38.478578, 7.059367)"
                    fill-rule="nonzero"
                  >
                    <path
                      d="M6.61815645,18.929874 C8.62144645,18.929874 10.225295,18.3803885 11.4297022,17.2814177 C12.6341093,16.1824469 13.2363129,14.6921451 13.2363129,12.8105124 L13.2363129,12.8105124 L13.2363129,0.973258301 L10.1705492,0.973258301 L10.1705492,12.7253523 C10.1705492,15.2233819 8.98641831,16.4723967 6.61815645,16.4723967 C5.45024648,16.4723967 4.56620353,16.160143 3.96602758,15.5356356 C3.36585162,14.9111282 3.06576365,14.006809 3.06576365,12.8226781 L3.06576365,12.8226781 L3.06576365,0.973258301 L3.54069307e-14,0.973258301 L3.54069307e-14,12.7983467 C3.54069307e-14,14.7205318 0.596120709,16.2229993 1.78836213,17.3057492 C2.98060355,18.388499 4.59053499,18.929874 6.61815645,18.929874 Z M20.425772,18.6865594 L20.425772,9.31894823 C21.009727,8.24025361 21.8978252,7.7009063 23.0900666,7.7009063 C23.9092257,7.7009063 24.4992635,7.90164083 24.8601801,8.30310988 C25.2210968,8.70457893 25.4015551,9.32300347 25.4015551,10.1583835 L25.4015551,10.1583835 L25.4015551,18.6865594 L28.3578272,18.6865594 L28.3578272,9.98806331 C28.3091642,6.84930529 26.9141607,5.27992628 24.1728165,5.27992628 C22.5912717,5.27992628 21.3138702,5.86793651 20.3406119,7.04395695 L20.3406119,7.04395695 L20.2554518,5.52324086 L17.4694999,5.52324086 L17.4694999,18.6865594 L20.425772,18.6865594 Z"
                      id="Un"
                      fill="#2F2E2E"
                    ></path>
                    <path
                      d="M36.009584,18.6865594 L36.009584,11.8615855 L39.4403195,11.8615855 L42.9927123,18.6865594 L46.2896248,18.6865594 L46.2896248,18.5284049 L42.3114315,11.1438075 C43.3333527,10.7139518 44.1302079,10.0995825 44.7019972,9.30069964 C45.2737864,8.50181678 45.559681,7.51030989 45.559681,6.32617896 C45.559681,4.59053499 45.0041127,3.26447055 43.8929762,2.34798565 C42.7818396,1.43150075 41.2043501,0.973258301 39.1605077,0.973258301 L39.1605077,0.973258301 L32.9316546,0.973258301 L32.9316546,18.6865594 L36.009584,18.6865594 Z M39.1726734,9.3919426 L36.009584,9.3919426 L36.009584,3.45506697 L39.2578335,3.45506697 C40.3284177,3.47128794 41.1333834,3.73893397 41.6727307,4.25800507 C42.212078,4.77707616 42.4817517,5.51107513 42.4817517,6.46000197 C42.4817517,7.36837639 42.1897742,8.08412676 41.6058192,8.6072531 C41.0218642,9.13037943 40.2108156,9.3919426 39.1726734,9.3919426 L39.1726734,9.3919426 Z M55.267446,18.929874 C56.3623616,18.929874 57.3498132,18.7129185 58.2298009,18.2790075 C59.1097887,17.8450965 59.8133733,17.2347824 60.3405549,16.4480653 L60.3405549,16.4480653 L58.7468444,14.9273492 C57.8952434,16.0222648 56.7922173,16.5697226 55.4377662,16.5697226 C54.4726184,16.5697226 53.6717079,16.2534136 53.0350348,15.6207957 C52.3983616,14.9881778 52.0354174,14.1284663 51.946202,13.0416612 L51.946202,13.0416612 L60.5473723,13.0416612 L60.5473723,11.8494198 C60.5473723,9.75691447 60.0587155,8.13887254 59.081402,6.99529404 C58.1040884,5.85171553 56.719223,5.27992628 54.9268056,5.27992628 C53.7994481,5.27992628 52.7775268,5.56784853 51.8610419,6.14369302 C50.944557,6.71953752 50.2328619,7.52450324 49.7259565,8.55859018 C49.2190512,9.59267713 48.9655985,10.76667 48.9655985,12.0805687 L48.9655985,12.0805687 L48.9655985,12.4455405 C48.9655985,14.4082781 49.5475259,15.9796847 50.7113806,17.1597604 C51.8752353,18.3398361 53.3939238,18.929874 55.267446,18.929874 Z M57.6275974,10.8761615 L51.994865,10.8761615 C52.1327432,9.86235078 52.4510798,9.07157841 52.9498747,8.5038444 C53.4486695,7.93611039 54.1035913,7.65224339 54.9146399,7.65224339 C55.7337989,7.65224339 56.3745273,7.90569607 56.836825,8.41260144 C57.2991227,8.9195068 57.5627135,9.66769912 57.6275974,10.6571784 L57.6275974,10.6571784 L57.6275974,10.8761615 Z M69.8779996,18.6865594 L74.4401479,5.52324086 L71.38655,5.52324086 L68.6005981,14.9395149 L65.7781491,5.52324086 L62.7123854,5.52324086 L67.3110309,18.6865594 L69.8779996,18.6865594 Z M83.198986,18.929874 C84.2939016,18.929874 85.2813533,18.7129185 86.161341,18.2790075 C87.0413287,17.8450965 87.7449134,17.2347824 88.2720949,16.4480653 L88.2720949,16.4480653 L86.6783845,14.9273492 C85.8267835,16.0222648 84.7237574,16.5697226 83.3693063,16.5697226 C82.4041584,16.5697226 81.603248,16.2534136 80.9665748,15.6207957 C80.3299017,14.9881778 79.9669574,14.1284663 79.8777421,13.0416612 L79.8777421,13.0416612 L88.4789123,13.0416612 L88.4789123,11.8494198 C88.4789123,9.75691447 87.9902556,8.13887254 87.012942,6.99529404 C86.0356285,5.85171553 84.650763,5.27992628 82.8583456,5.27992628 C81.7309881,5.27992628 80.7090669,5.56784853 79.792582,6.14369302 C78.8760971,6.71953752 78.164402,7.52450324 77.6574966,8.55859018 C77.1505912,9.59267713 76.8971386,10.76667 76.8971386,12.0805687 L76.8971386,12.0805687 L76.8971386,12.4455405 C76.8971386,14.4082781 77.4790659,15.9796847 78.6429206,17.1597604 C79.8067753,18.3398361 81.3254638,18.929874 83.198986,18.929874 Z M85.5591374,10.8761615 L79.926405,10.8761615 C80.0642833,9.86235078 80.3826198,9.07157841 80.8814147,8.5038444 C81.3802096,7.93611039 82.0351313,7.65224339 82.8461799,7.65224339 C83.665339,7.65224339 84.3060674,7.90569607 84.7683651,8.41260144 C85.2306628,8.9195068 85.4942535,9.66769912 85.5591374,10.6571784 L85.5591374,10.6571784 L85.5591374,10.8761615 Z M96.1185034,18.929874 C97.481065,18.929874 98.632754,18.4391896 99.5735704,17.4578208 C99.6708962,18.0255548 99.784443,18.4351343 99.9142108,18.6865594 L99.9142108,18.6865594 L102.931312,18.6865594 L102.931312,18.479742 C102.598782,17.7741297 102.432517,16.8292581 102.432517,15.6451272 L102.432517,15.6451272 L102.432517,9.70825155 C102.408185,8.3051375 101.937777,7.21630478 101.021292,6.44175338 C100.104807,5.66720198 98.8760686,5.27992628 97.3350763,5.27992628 C96.3212655,5.27992628 95.402753,5.45835697 94.5795387,5.81521835 C93.7563244,6.17207972 93.1054579,6.66479174 92.6269392,7.29335439 C92.1484206,7.92191704 91.9091613,8.59711499 91.9091613,9.31894823 L91.9091613,9.31894823 L94.8654333,9.31894823 C94.8654333,8.79987714 95.0803612,8.37204901 95.510217,8.03546385 C95.9400727,7.69887868 96.4915858,7.5305861 97.1647561,7.5305861 C97.9433627,7.5305861 98.5232625,7.73537587 98.9044553,8.1449554 C99.2856481,8.55453494 99.4762445,9.09996511 99.4762445,9.78124592 L99.4762445,9.78124592 L99.4762445,10.6450127 L97.663551,10.6450127 C95.7251448,10.6450127 94.2348431,11.0201226 93.1926456,11.7703426 C92.1504482,12.5205625 91.6293495,13.5972295 91.6293495,15.0003436 C91.6293495,16.1114801 92.0470395,17.044186 92.8824196,17.7984612 C93.7177996,18.5527364 94.7964942,18.929874 96.1185034,18.929874 Z M96.6659612,16.5575568 C96.0333433,16.5575568 95.5284656,16.3892643 95.151328,16.0526791 C94.7741904,15.7160939 94.5856216,15.2639344 94.5856216,14.6962003 C94.5856216,13.9986986 94.8613781,13.4593513 95.4128911,13.0781584 C95.9644042,12.6969656 96.7876185,12.5063692 97.8825341,12.5063692 L97.8825341,12.5063692 L99.4762445,12.5063692 L99.4762445,14.9881778 C99.216709,15.4666965 98.8294333,15.8478893 98.3144174,16.1317563 C97.7994016,16.4156233 97.2499162,16.5575568 96.6659612,16.5575568 Z M109.95045,18.6865594 L109.95045,0 L106.994178,0 L106.994178,18.6865594 L109.95045,18.6865594 Z M119.062095,18.929874 C120.538203,18.929874 121.718279,18.3945819 122.602322,17.3239978 L122.602322,17.3239978 L122.74831,18.6865594 L125.424771,18.6865594 L125.424771,0 L122.468499,0 L122.468499,6.73981373 C121.608787,5.76655543 120.48143,5.27992628 119.086426,5.27992628 C117.504881,5.27992628 116.243701,5.89429558 115.302884,7.12303419 C114.362068,8.35177279 113.89166,9.97995283 113.89166,12.0075743 C113.89166,14.1406321 114.368151,15.8276131 115.321133,17.0685174 C116.274115,18.3094218 117.521102,18.929874 119.062095,18.929874 Z M119.81637,16.5210597 C118.867443,16.5210597 118.135472,16.1459497 117.620456,15.3957297 C117.10544,14.6455098 116.847932,13.6012848 116.847932,12.2630546 C116.847932,10.7382833 117.107468,9.59673237 117.626539,8.83840194 C118.14561,8.08007152 118.883664,7.7009063 119.840701,7.7009063 C121.049164,7.7009063 121.925096,8.22808788 122.468499,9.28245104 L122.468499,9.28245104 L122.468499,14.9030177 C121.908875,15.9817123 121.024832,16.5210597 119.81637,16.5210597 Z"
                      id="Reveald"
                      fill="#50C2E6"
                    ></path>
                  </g>
                </g>
              </g>
            </svg>
          </a>
        </div>
        <form className="mt-3" id="signin-newuser" onSubmit={this.handleSubmit}>
          <div className="row">
            <div className="col-sm-12">
              <h3 className="forgot"> Forgot Password</h3>
              <div className="form-group" id="emailid">
                <input
                  type="email"
                  placeholder="Email id"
                  className="form-control"
                  id="email"
                  onChange={this.handleChange}
                ></input>
                <p style={{ textAlign: "right", color: "red" }}>
                  {this.state.showError}
                </p>
              </div>
            </div>
            {/* <div className="col-sm-12">
              <div className="form-group" id="password">
                <input
                  type="password"
                  placeholder="Password"
                  className="form-control"
                  id="password"
                  onChange={this.handleChange}
                ></input>
              </div>
            </div> */}
          </div>
          {/* <div className="row p-0">
            <div className="col-6">
              <div className="form-check" id="remember">
                <input
                  type="checkbox"
                  className="form-check-input"
                  onChange={this.handleChange}
                />
                <label className="form-check-label ml-4 pl-2" htmlFor="Check1">
                  Remember
                </label>
              </div>
            </div> */}
          {/* <div className="col-6">
              <div className="form-check text-right" id="forgot-pw">
                <span>Forgot Password?</span>
              </div>
            </div> */}
          {/* </div> */}

          <div className="row">
            <div className="col-sm-12 mt-5">
              <button
                type="submit"
                className="btn btn-primary"
                id="signin-newus"
              >
                Submit
              </button>
              <div className="error center red-text mt-3">
                {authError ? <p>{authError}</p> : null}
              </div>
            </div>
          </div>
        </form>
      </div>
    );
  }
}

const mapStateToProps = (state) => {
  return {
    authError: state.auth.authError,
    auth: state.firebase.auth,
  };
};

const mapDispatchToProps = (dispatch) => {
  return {
    signIn: (creds) => dispatch(signIn(creds)),
    passwordReset: (creds) => dispatch(passwordReset(creds)),
  };
};

export default connect(mapStateToProps, mapDispatchToProps)(ForgotPassword);
